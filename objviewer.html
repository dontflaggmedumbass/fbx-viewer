<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 3D Model Viewer</title>
    <style>
        body { margin: 0; background-color: #1a1a1a; color: white; font-family: sans-serif; overflow: hidden; }
        #canvas-container { width: 100vw; height: 100vh; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        #loader-info { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #aaa; }
        .controls-hint { font-size: 0.8rem; opacity: 0.7; }
    </style>
</head>
<body>

    <div id="ui">
        <h2>3D Viewer</h2>
        <div class="controls-hint">Rotate: Left Click | Zoom: Scroll | Pan: Right Click</div>
    </div>
    <div id="loader-info">Initializing Scene...</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';

        // --- CONFIGURATION ---
        // Change this to your RAW GitHub URL
        const MODEL_URL = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/models/fbx/Samba%20Dancing.fbx';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111111);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
        camera.position.set(0, 200, 400);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 2);
        hemiLight.position.set(0, 200, 0);
        scene.add(hemiLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 2);
        dirLight.position.set(0, 200, 100);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // Grid Floor
        const grid = new THREE.GridHelper(2000, 20, 0x000000, 0x000000);
        grid.material.opacity = 0.2;
        grid.material.transparent = true;
        scene.add(grid);

        // --- CONTROLS ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.target.set(0, 100, 0);

        // --- LOADING LOGIC ---
        const statusEl = document.getElementById('loader-info');
        const manager = new THREE.LoadingManager();

        manager.onStart = () => statusEl.innerText = 'Downloading from GitHub...';
        manager.onProgress = (url, itemsLoaded, itemsTotal) => {
            statusEl.innerText = `Loading: ${Math.round((itemsLoaded / itemsTotal) * 100)}%`;
        };
        manager.onLoad = () => statusEl.innerText = 'Model Loaded';
        manager.onError = (url) => statusEl.innerText = 'Error loading model from: ' + url;

        // Determine Loader
        const extension = MODEL_URL.split('.').pop().toLowerCase();
        let loader;

        if (extension === 'fbx') {
            loader = new FBXLoader(manager);
        } else if (extension === 'obj') {
            loader = new OBJLoader(manager);
        }

        if (loader) {
            loader.load(MODEL_URL, (object) => {
                // Auto-center and Scale logic
                const box = new THREE.Box3().setFromObject(object);
                const size = box.getSize(new THREE.Vector3());
                const center = box.getCenter(new THREE.Vector3());

                // Adjust position so it sits on the grid
                object.position.x += (object.position.x - center.x);
                object.position.y += (object.position.y - box.min.y);
                object.position.z += (object.position.z - center.z);

                scene.add(object);
            });
        }

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
